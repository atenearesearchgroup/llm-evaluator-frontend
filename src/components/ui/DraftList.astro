---
import { db, Draft, Interaction } from "astro:db";

const drafts = await db.select().from(Draft);
---

<aside
    class="bg-slate-800 bg-opacity-70 rounded-r-3xl
pr-2 py-3
flex flex-col h-dvh"
>
    <div class="flex flex-row">
        <h2 class="font-bold text-lg ml-8">Drafts</h2>

        <button id="toggle" class="text-md font-bold mx-2"> X </button>
    </div>
    <ul id="list" class="m-3 max-h-dvh overflow-x-auto overflow-y-hidden">
        {
            drafts.map((draft) => (
                <li class="m-4 flex flex-col bg-slate-600 bg-opacity-30 p-2 text-sm rounded-lg">
                    <a href={`/drafts/${draft.id}`} class="font-bold">
                        {draft.title}
                    </a>
                    <p class="text-end">{draft.currentPhase}</p>
                </li>
            ))
        }
    </ul>
</aside>

<script>
    function init() {
        const $toggle = document.getElementById("toggle");
        const $aside = document.getElementById("list");

        if (!$toggle || !$aside) {
            return;
        }

        $toggle.addEventListener("click", () => {
            $aside.classList.toggle("hidden");
        });
    }
    init();

    document.addEventListener("astro:after-swap", init);
</script>
